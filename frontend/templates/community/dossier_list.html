{% extends "base.html" %}

{% block title %}Santé communautaire{% endblock %}

{% block content %}
<h1 class="page-title">Santé communautaire</h1>

<form method="get" class="filters">
  <div class="grid grid--4">
    <div class="form__row">
      <label class="form__label">Pathologie</label>
      <select name="pathologie">
        <option value="">Toutes</option>
        {% for p in pathologies %}
          <option value="{{ p.code }}" {% if filters.pathologie == p.code %}selected{% endif %}>{{ p.nom }}</option>
        {% endfor %}
      </select>
    </div>
    <div class="form__row">
      <label class="form__label">Statut</label>
      <select name="statut">
        <option value="">Tous</option>
        {% for value, label in statuts %}
          <option value="{{ value }}" {% if filters.statut == value %}selected{% endif %}>{{ label }}</option>
        {% endfor %}
      </select>
    </div>
    <div class="form__row">
      <label class="form__label">Zone</label>
      <select name="zone">
        <option value="">Toutes</option>
        {% for value, label in zones %}
          <option value="{{ value }}" {% if filters.zone == value %}selected{% endif %}>{{ label }}</option>
        {% endfor %}
      </select>
    </div>
    <div class="form__row">
      <label class="form__label">Date diagnostic</label>
      <input type="date" name="date" value="{{ filters.date }}">
    </div>
  </div>
  <div class="form__actions" style="margin-top: 8px;">
    <button class="btn" type="submit">Filtrer</button>
    <a class="btn btn--secondary" href="/community/">Réinitialiser</a>
  </div>
</form>

<div class="page-actions">
  <a class="btn btn--primary" href="/community/nouveau/">Nouveau dossier</a>
</div>

<div class="table">
  <div class="table__row table__row--head">
    <div class="table__cell">Patient</div>
    <div class="table__cell">Pathologie</div>
    <div class="table__cell">Diagnostic</div>
    <div class="table__cell">Statut</div>
    <div class="table__cell"></div>
  </div>

  {% for d in dossiers %}
    <div class="table__row" style="grid-template-columns: 1fr 1fr 140px 140px 80px;">
      <div class="table__cell">{{ d.patient.code_patient }} - {{ d.patient.nom }} {{ d.patient.prenoms }}</div>
      <div class="table__cell">{{ d.pathologie.nom }}</div>
      <div class="table__cell">{{ d.date_diagnostic }}</div>
      <div class="table__cell">{{ d.get_statut_display }}</div>
      <div class="table__cell"><a class="link" href="/community/{{ d.id }}/">Voir</a></div>
    </div>
  {% empty %}
    <div class="table__row" style="grid-template-columns: 1fr;">
      <div class="table__cell">Aucun dossier.</div>
    </div>
  {% endfor %}
</div>
{% endblock %}
